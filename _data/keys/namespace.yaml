---

- key: pg.namespace.discovery
  description: Discover all Namespaces visible to the configured user account.
  type: Discovery
  macros: 
    - macro: "{#OID}"
      description: Namespace unique identifier

    - macro: "{#NAMESPACE}"
      description: Namespace name

    - macro: "{#DATABASE}"
      description: Parent database of the namespace

    - macro: "{#OWNER}"
      description: Owner name

  source: >

    SELECT
      n.oid
      , n.nspname
      , current_database()
      , a.rolname
    FROM pg_namespace n
    JOIN pg_authid a ON a.oid = n.nspowner


- key: pg.namespace.size
  description: Returns the size in bytes of a PostgreSQL Namespace
  type: Numeric (unsigned)
  parameters:
    - parameter: namespace
      description: The name or OID of the desired Namespace (required)
  units: B
  source: >

    SELECT
      sum(pg_relation_size(quote_ident(schemaname) || '.' || quote_ident(tablename)))::bigint
    FROM pg_tables
    WHERE schemaname = $1
